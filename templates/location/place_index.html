{% extends 'base.html' %}
{% load location_extras %}
{% block content %}
<h2>{{place.name}}</h2>
<p>Total: {{total_posts}} Posts</p>
<br>
<h3>Recent Uncategorised Posts</h3>
<div id="thumb-section">
	<div class="thumb-box">
	{% if main_dict %}
		{% for item in main_dict %}
		<!-- Button trigger modal -->
		<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal-{{item.post.id}}">
		  {% with page_num as page_num  %}{{ forloop.counter|post_page_num:page_num }}. {% endwith %}<img src="{{item.post.weibo_thumb_img}}" alt="{{item.post.id}}">
		</button>
		<!-- Modal -->
		<div class="modal" id="myModal-{{item.post.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">{{item.post.created}}</h4>
					</div>
					<div class="modal-body">
						<h4>Place</h4>
						<p>{{item.post.place}}</p>
						<h4>Location</h4>
						<p>{{item.post.user.location}}</p>
						<h4>Username</h4>
						<p>{{item.post.user.weibo_name}}</p>
						<h4>Gender</h4>
						<p>{{item.post.user.gender}}</p>
						<h4>Text</h4>
						<p>{{item.post.text}}</p>
						<h4>Category</h4>
						<p class="category-field">None</p>
						<h4>ID</h4>
						<p>{{item.post.id}}</p>
						<hr>
						<form id="categorise-form-{{item.post.id}}" action="{% url 'location:categorise_post' item.post.place.id item.post.id %}" method="POST">
							{% csrf_token %}
						    {{ item.form.as_p }}
						    <input type="submit" value="Update" />
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
			<!--<a href="{% url 'location:categorise_post' place.id item.post.id %}">
				<img src="{{item.post.weibo_thumb_img}}" alt="{{item.post.id}}">
			</a>-->
		{% endfor %}
	{% else %}
		<h4>Sorry, there is no result.</h4>
	{% endif %}
	</div>
</div>

<div class="pagination-section text-center">
	{% if page_num != 1 %}
	<a href="?page={{ page_num|add:"-1" }}"><< Prev </a>
	{% endif %}
	<a href="?page={{ page_num|add:"1" }}"> Next >></a>
</div>
<div class="alert alert-success hide">
    <button type="button" aria-hidden="true" class="close">Ã—</button>
    <span><b> Success - </b> This is a regular notification made with ".alert-success"</span>
</div>
{% endblock %}
{% block js %}
<script>
{% if main_dict %}	
{% for item in main_dict %}
	$('#categorise-form-{{item.post.id}}').on('submit', function(event){
	    event.preventDefault();
	    console.log("form submitted!"); 
	    catogorise_post($(this));
	});
{% endfor %}
{% endif %}
</script>
{% endblock %}